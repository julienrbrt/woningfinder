alerts:
  - rule: DEPLOYMENT_FAILED
  - rule: DOMAIN_LIVE
  - rule: DEPLOYMENT_LIVE
  - rule: DOMAIN_FAILED
databases:
  - cluster_name: woningfinder-redis
    engine: REDIS
    name: woningfinder-redis
    production: true
    version: "6"
  - cluster_name: woningfinder-db
    engine: PG
    name: woningfinder-db
    production: true
    version: "12"
domains:
  - domain: woningfinder.nl
    type: PRIMARY
    zone: woningfinder.nl
  - domain: www.woningfinder.nl
    type: ALIAS
    zone: woningfinder.nl
envs:
  - key: APP_NAME
    scope: RUN_AND_BUILD_TIME
    value: WoningFinder
  - key: APP_PORT
    scope: RUN_AND_BUILD_TIME
    value: "8080"
  - key: APP_DEBUG
    scope: RUN_AND_BUILD_TIME
    value: "false"
  - key: JWT_SECRET
    scope: RUN_AND_BUILD_TIME
    value: ioreh98r34fujceirjgeoijgjeujhgoi732yevjn209pr2kwjknewl02
  - key: AES_SECRET
    scope: RUN_AND_BUILD_TIME
    value: 3b01eb9846cc2136be82c0b9d736a5f8cb5ed19bcd733815013b428f9cc90c5e
  - key: SENTRY_DSN
    scope: RUN_AND_BUILD_TIME
    value: https://5e1d3d3280b8462bb170b8cb04227c6a@o496598.ingest.sentry.io/5571559
  - key: MAPBOX_API_KEY
    scope: RUN_AND_BUILD_TIME
    type: SECRET
    value: EV[1:5UOPhoYyocEPlDtXzKaRQGiSd8Hhs8Io:84zgfM9uH+yB/rWQpqgG6K5/4zgwkJBN8OGtqM7XYUblZCce/I+jPluN9t4a6MBoeLip7HjA6l3977pC5IKOH17PLBQFz41vuTdJLqbbca5tOQRLjRrh9WmcVsqMuAXue/DlVIBqmwMcAqynaQ==]
  - key: STRIPE_PUBLISHABLE_KEY
    scope: RUN_AND_BUILD_TIME
    type: SECRET
    value: EV[1:B3lkVYAojJHVT/dbd+kWTvOTSVPQQrZE:U5LsybKprgoTAWWEzXYMGCryoygpMW7rbKoCLbkM66eKUbPRXFGbo2s2OMimv9MH5S5iKbPJGHUc569P6pc3By6P12IMSyskt0pF+M/zSu2usTfRU3a8lSv7gaMAefwtQSTWf3NkCPz2c7xZcLDOAuHXi0RXQeG9DOHL]
  - key: STRIPE_API_KEY
    scope: RUN_AND_BUILD_TIME
    type: SECRET
    value: EV[1:cY3QW//DBV3sshG8w24CvNh3k5XMRmMx:S35/u7MD+lvv38++vLL3wA9zZ1X0N2+8OD3uxqMU+C7VnzypfXQb3S7tjkD3uQ+Mr0jzwZrOcs5bYH46zDmB4aql5heRM+CIVplOmf74tkIEUtWvQzuYAIHiTp6XNJhtgP2fpKgu1VV+nt3LzKvJocMaF3lTQAZbuqld]
  - key: STRIPE_WEBHOOK_SIGNING_KEY
    scope: RUN_AND_BUILD_TIME
    type: SECRET
    value: EV[1:7lD/Fzd9pKs6wH0lOg/fWeuajnsATIpP:GJHUFMZL24tYyV56wAlaShoDNH0h1XfQ4l28uA9mnWJQAn9OqfJUuvuFdoSbS1VZDl53BdkH]
  - key: DO_SPACES_KEY
    scope: RUN_AND_BUILD_TIME
    value: 6HFGIEXLFFAF3ZEU5MAF
  - key: DO_SPACES_SECRET
    scope: RUN_AND_BUILD_TIME
    type: SECRET
    value: EV[1:ufYKg6W8Qx1uYDEDc/FtS2FChgbHl3oe:VzLuvScsHhQnmIgp4IbO16zDFF6GVdIf7Gjd21XvwvSXaw1dkFqfUWfvyKZU1emLN//p3IeVk11ZJgw=]
  - key: POSTMARK_SERVER_KEY
    scope: RUN_AND_BUILD_TIME
    type: SECRET
    value: EV[1:JXgqgjIsGuinhdZilO0bl32ZYOu1G5hx:4scP3dByJvVm1OjjPdnXPn8vabqFtorzdKc1aMNaZWi8BidbjbLsVRwaQEKx2UUNXAVjvw==]
  - key: DATABASE_URL
    scope: RUN_AND_BUILD_TIME
    value: postgres://${woningfinder-db.USERNAME}:${woningfinder-db.PASSWORD}@${woningfinder-db.HOSTNAME}:${woningfinder-db.PORT}/woningfinder?sslmode=require
  - key: REDIS_URL
    scope: RUN_AND_BUILD_TIME
    value: ${woningfinder-redis.DATABASE_URL}
jobs:
  - alerts:
      - operator: GREATER_THAN
        rule: CPU_UTILIZATION
        value: 75
        window: TEN_MINUTES
    environment_slug: go
    github:
      branch: main
      deploy_on_push: true
      repo: julienrbrt/woningfinder
    instance_count: 1
    instance_size_slug: professional-xs
    kind: PRE_DEPLOY
    name: woningfinder-db-migration
    run_command: bin/db-migrator
  - environment_slug: go
    github:
      branch: main
      deploy_on_push: true
      repo: julienrbrt/woningfinder
    instance_count: 1
    instance_size_slug: professional-xs
    kind: POST_DEPLOY
    name: woningfinder-city-updater
    run_command: bin/city-location-updater
    source_dir: /
name: woningfinder
region: ams
services:
  - alerts:
      - operator: GREATER_THAN
        rule: CPU_UTILIZATION
        value: 75
        window: TEN_MINUTES
    environment_slug: go
    github:
      branch: main
      deploy_on_push: true
      repo: julienrbrt/woningfinder
    http_port: 8080
    instance_count: 1
    instance_size_slug: professional-xs
    name: woningfinder
    routes:
      - path: /api
    run_command: ./bin/woningfinder-api
static_sites:
  - build_command: npm run generate --fail-on-error
    environment_slug: node-js
    envs:
      - key: SENTRY_DSN
        scope: BUILD_TIME
        value: https://77b9fd4657304ec49bf0ecc49f742e64@o496598.ingest.sentry.io/6050841
    github:
      branch: main
      deploy_on_push: true
      repo: julienrbrt/woningfinder.nl
    name: woningfinder-nl
    output_dir: dist
    routes:
      - path: /
workers:
  - alerts:
      - operator: GREATER_THAN
        rule: CPU_UTILIZATION
        value: 75
        window: TEN_MINUTES
    environment_slug: go
    github:
      branch: main
      deploy_on_push: true
      repo: julienrbrt/woningfinder
    instance_count: 1
    instance_size_slug: professional-xs
    name: woningfinder-housing-matcher
    run_command: bin/housing-matcher
  - alerts:
      - operator: GREATER_THAN
        rule: CPU_UTILIZATION
        value: 75
        window: TEN_MINUTES
    environment_slug: go
    github:
      branch: main
      deploy_on_push: true
      repo: julienrbrt/woningfinder
    instance_count: 1
    instance_size_slug: professional-xs
    name: woningfinder-orchestrator
    run_command: bin/orchestrator
